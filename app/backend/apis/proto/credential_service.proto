syntax = "proto3";

package backend.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/project-planton/project-planton/app/backend/apis/gen/go/proto;v1";

// CredentialService provides operations for managing cloud provider credentials.
service CredentialService {
  // CreateCredential creates a new cloud provider credential.
  rpc CreateCredential(CreateCredentialRequest) returns (CreateCredentialResponse);
  // ListCredentials lists all credentials with optional provider filter.
  rpc ListCredentials(ListCredentialsRequest) returns (ListCredentialsResponse);
}

// CredentialProvider enum for supported cloud providers.
enum CredentialProvider {
  CREDENTIAL_PROVIDER_UNSPECIFIED = 0;
  GCP = 1;
  AWS = 2;
  AZURE = 3;
}

// Request message for creating a credential.
message CreateCredentialRequest {
  // Name of the credential.
  string name = 1;
  // Provider type (gcp, aws, azure).
  CredentialProvider provider = 2;
  // Provider-specific credential data (oneof).
  oneof credential_data {
    GcpCredentialSpec gcp = 3;
    AwsCredentialSpec aws = 4;
    AzureCredentialSpec azure = 5;
  }
}

// Response message for creating a credential.
message CreateCredentialResponse {
  // Created credential.
  Credential credential = 1;
}

// Generic credential message.
message Credential {
  // Unique identifier.
  string id = 1;
  // Name of the credential.
  string name = 2;
  // Provider type.
  CredentialProvider provider = 3;
  // Provider-specific credential data.
  oneof credential_data {
    GcpCredentialSpec gcp = 4;
    AwsCredentialSpec aws = 5;
    AzureCredentialSpec azure = 6;
  }
  // Creation timestamp.
  google.protobuf.Timestamp created_at = 7;
  // Last update timestamp.
  google.protobuf.Timestamp updated_at = 8;
}

// GCP credential specification.
message GcpCredentialSpec {
  // Base64-encoded GCP service account key JSON.
  string service_account_key_base64 = 1;
}

// AWS credential specification.
message AwsCredentialSpec {
  // AWS account ID.
  string account_id = 1;
  // AWS access key ID.
  string access_key_id = 2;
  // AWS secret access key.
  string secret_access_key = 3;
  // AWS region (optional).
  optional string region = 4;
  // AWS session token (optional).
  optional string session_token = 5;
}

// Azure credential specification.
message AzureCredentialSpec {
  // Azure client ID.
  string client_id = 1;
  // Azure client secret.
  string client_secret = 2;
  // Azure tenant ID.
  string tenant_id = 3;
  // Azure subscription ID.
  string subscription_id = 4;
}

// Request message for listing credentials.
message ListCredentialsRequest {
  // Optional filter by provider (gcp, aws, azure).
  optional CredentialProvider provider = 1;
}

// Response message for listing credentials.
message ListCredentialsResponse {
  // List of credentials (without sensitive data).
  repeated CredentialSummary credentials = 1;
}

// Credential summary (without sensitive credential data).
message CredentialSummary {
  // Unique identifier.
  string id = 1;
  // Name of the credential.
  string name = 2;
  // Provider type.
  CredentialProvider provider = 3;
  // Creation timestamp.
  google.protobuf.Timestamp created_at = 4;
  // Last update timestamp.
  google.protobuf.Timestamp updated_at = 5;
}

