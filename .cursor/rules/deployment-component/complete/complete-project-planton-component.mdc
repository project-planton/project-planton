---
alwaysApply: false
---

# Complete: Audit and Auto-Improve to 100%

## Purpose

This convenience rule combines **audit** and **update** into a single operation: assess a component's current state and automatically bring it to 100% (or target score) completion by filling all identified gaps.

## Role

You are the Project Planton Code Partner. This rule orchestrates a complete quality improvement workflow: audit â†’ identify gaps â†’ fill gaps â†’ verify completion.

## When to Use Complete

Use complete when you want to:
- âœ… **Bring component to 100%** - One command to achieve ideal state
- âœ… **Quick quality improvement** - No need to manually run audit then update
- âœ… **Batch improvement** - Rapidly improve multiple components
- âœ… **Quality gates** - Ensure components meet standards before release
- âœ… **Onboarding existing components** - Systematically complete legacy components

**Use manual audit/update when:**
- âŒ You only want to check status (just audit)
- âŒ You want to control which gaps to fill (manual update with specific scenario)
- âŒ You want to preview changes first (use update --dry-run)
- âŒ Component is already complete (no work needed)

## Usage

### Basic Syntax

```
@complete-project-planton-component <ComponentName> [flags]
```

### Examples

**Simplest usage:**
```bash
@complete-project-planton-component MongodbAtlas
```

**With target score:**
```bash
@complete-project-planton-component GcpCertManagerCert --target-score 90
```

**Preview mode:**
```bash
@complete-project-planton-component PostgresKubernetes --dry-run
```

## Workflow

### Step 1: Initial Audit

**Action:** Run audit to assess current state

```
ğŸ” Auditing MongodbAtlas...

Current State:
  Overall Score: 65%
  Status: Partially Complete
  
Missing Items:
  âŒ Terraform module (4.44%)
  âŒ Research documentation (13.34%)
  âŒ Pulumi overview (5%)
  âš ï¸  Examples incomplete (3.33%)

Audit report saved: v1/docs/audit/2025-11-13-094500.md
```

**Decision Logic:**

```
IF score â‰¥ target_score (default 95%):
  â†’ Report "Already complete!" and exit
  
IF score < target_score:
  â†’ Proceed to Step 2 (fill gaps)
```

### Step 2: Fill Gaps (if needed)

**Action:** Run update --fill-gaps to complete component

```
ğŸ”„ Completing MongodbAtlas (65% â†’ 95%+)...

Phase 1: Generate Terraform Module
[1/7] âœ… Generated variables.tf (matches spec.proto)
[2/7] âœ… Generated provider.tf
[3/7] âœ… Generated locals.tf
[4/7] âœ… Generated main.tf
[5/7] âœ… Generated outputs.tf
[6/7] âœ… Generated README.md
[7/7] âœ… Passed terraform validate

Phase 2: Generate Documentation
[8/9] âœ… Generated v1/docs/README.md (research document, 850 lines)
[9/9] âœ… Generated iac/pulumi/overview.md

Phase 3: Enhance Examples
[10/10] âœ… Added 3 more examples to examples.md

Phase 4: Final Validation
[11/12] âœ… Component tests passed (go test ./apis/.../v1/)
[12/13] âœ… Build validation passed (make build)
[13/13] âœ… Full test suite passed (make test)
```

**What Gets Created:**

The update --fill-gaps scenario will run appropriate forge flow rules to create:
- Missing proto files (if any)
- Missing IaC modules (Pulumi or Terraform)
- Missing documentation (research, user-facing, examples)
- Missing supporting files (manifests, debug scripts, overviews)

**Validation:**
- After each creation, validates build and tests
- Runs component-specific tests: `go test ./apis/.../provider/<provider>/<component>/v1/`
- Validates spec_test.go tests pass (buf.validate rules are correct)
- Runs full build validation: `make build`
- Runs full test suite: `make test`
- Retries up to 3 times on fixable errors
- Reports progress in real-time

**Critical:** Component tests (spec_test.go) must pass for component to be considered complete. Failing tests indicate validation rules are incorrect.

### Step 3: Final Audit

**Action:** Re-run audit to verify completion

```
ğŸ” Re-auditing MongodbAtlas...

Final State:
  Overall Score: 98%
  Status: Functionally Complete
  
Remaining Items:
  âš ï¸  1 minor item (Terraform E2E test logs)

Audit report saved: v1/docs/audit/2025-11-13-094530.md
```

### Step 4: Summary Report

**Action:** Show before/after comparison

```
âœ… Completion Successful: MongodbAtlas

Before:
  Score: 65%
  Status: Partially Complete
  Missing: 4 items

After:
  Score: 98%
  Status: Functionally Complete
  Missing: 1 minor item

Improvement: +33% (65% â†’ 98%)

Files Created:
  âœ… iac/tf/ (6 files) - Terraform module
  âœ… v1/docs/README.md (850 lines) - Research documentation
  âœ… iac/pulumi/overview.md - Architecture overview
  âœ… Enhanced v1/examples.md (3 new examples)

Audit Reports:
  ğŸ“Š Before: v1/docs/audit/2025-11-13-094500.md
  ğŸ“Š After: v1/docs/audit/2025-11-13-094530.md

Duration: 18 minutes

Next Steps:
  1. Review generated files
  2. Test deployment with: iac/hack/manifest.yaml
  3. Commit changes:
     git add -A
     git commit -m "improve: complete MongodbAtlas to 98%"
```

## Flags and Options

### --dry-run

Preview what would be done without making changes:

```bash
@complete-project-planton-component MongodbAtlas --dry-run
```

**Output:**
```
ğŸ” Dry-Run: Complete MongodbAtlas

Current State (from audit):
  Score: 65%
  Missing:
    âŒ Terraform module (4.44%)
    âŒ Research docs (13.34%)
    âŒ Pulumi overview (5%)
    âš ï¸  Examples incomplete (3.33%)

Planned Actions:
  1. Run forge rules 013-015 â†’ Create Terraform module
  2. Run forge rule 020 â†’ Generate research docs
  3. Run forge rule 021 â†’ Generate Pulumi overview
  4. Enhance examples.md â†’ Add 3 examples
  5. Run validation (rules 018-019)

Expected Result:
  Score: 98% (+33%)
  Duration: ~15-20 minutes
  Files Created: ~12

No files will be modified (dry-run mode)

To proceed: remove --dry-run flag
```

### --target-score <percentage>

Stop when target score is reached:

```bash
@complete-project-planton-component MongodbAtlas --target-score 90
```

**Behavior:**
- If current score â‰¥ 90%, exits immediately (already at target)
- If current score < 90%, fills gaps until â‰¥90%
- Doesn't necessarily reach 100% (stops at target)

**Use when:**
- You want "good enough" not "perfect"
- Time-constrained (90% might be achievable in 10 min vs 100% in 30 min)
- Some gaps are acceptable (e.g., missing overview.md is ok for your use case)

**Default target:** 95% (functionally complete)

### --skip-validation

Skip final build and test validation (faster but riskier):

```bash
@complete-project-planton-component MongodbAtlas --skip-validation
```

**Warning:** Use only when confident updates won't break builds.

## Workflow Details

### Already Complete Scenario

```bash
@complete-project-planton-component GcpCertManagerCert
```

**Output:**
```
ğŸ” Auditing GcpCertManagerCert...

Current State:
  Score: 98%
  Status: Functionally Complete

âœ… Component is already complete! (â‰¥95% target)

No action needed. Great job! ğŸ‰

Audit report: v1/docs/audit/2025-11-13-094600.md
```

### Partial Completion Scenario

```bash
@complete-project-planton-component MongodbAtlas
```

**Output:**
```
ğŸ” Step 1/3: Initial Audit

Current State:
  Score: 65%
  Status: Partially Complete
  
Gaps Identified:
  âŒ Critical (4.44%): Terraform module missing
  âŒ Important (13.34%): Research docs missing
  âŒ Important (5%): Pulumi overview missing
  âš ï¸  Important (3.33%): Examples incomplete

Target: 95% (need +30%)

---

ğŸ”„ Step 2/3: Filling Gaps

Running update --fill-gaps...

[Detailed progress as update executes]

---

ğŸ” Step 3/3: Final Verification

Re-auditing to verify completion...

Final State:
  Score: 98%
  Status: Functionally Complete

âœ… Completion successful! (+33% improvement)

Summary:
  Before: 65% (Partially Complete)
  After: 98% (Functionally Complete)
  
  Created:
    âœ… Terraform module (6 files)
    âœ… Research docs (850 lines)
    âœ… Pulumi overview
    âœ… Enhanced examples (3 added)
  
  Duration: 18 minutes

Audit Reports:
  ğŸ“Š Before: v1/docs/audit/2025-11-13-094500.md
  ğŸ“Š After: v1/docs/audit/2025-11-13-094530.md

Next: Review files and commit changes
```

### Nearly Complete Scenario

```bash
@complete-project-planton-component PostgresKubernetes
```

**Output:**
```
ğŸ” Auditing PostgresKubernetes...

Current State:
  Score: 92%
  Status: Functionally Complete
  
Small Gaps:
  âš ï¸  Pulumi overview missing (5%)
  âš ï¸  Terraform README could be expanded (2%)

Target: 95% (need +3%)

---

ğŸ”„ Filling Small Gaps

[Quick generation of missing items]

---

âœ… Completion successful!

Before: 92%
After: 97%

Duration: 3 minutes
```

## Error Handling

### Component Not Found

```
âŒ Error: MongodbAtlas not found

Checked:
  âœ“ cloud_resource_kind.proto - No enum entry
  âœ“ File system - No component folder

Did you mean to create it first?
  @forge-project-planton-component MongodbAtlas --provider atlas
```

### Already at Target

```
âœ… GcpCertManagerCert is already complete!

Current Score: 98%
Target Score: 95%

Nothing to do. Component is production-ready! ğŸ‰
```

### Update Failed

```
âŒ Error: Failed to complete MongodbAtlas

Initial Audit: âœ… 65%
Gap Filling: âŒ Failed at rule 013 (Terraform module generation)

Error: terraform validate failed
  Missing required provider configuration

Recommendation:
  1. Check provider.tf configuration
  2. Run update manually to debug:
     @update-project-planton-component MongodbAtlas --scenario fill-gaps
  3. Or resume from failed rule:
     @update-project-planton-component MongodbAtlas --resume-from 013

Partial Progress:
  âœ… Research docs generated
  âŒ Terraform module failed
  â¸ï¸  Remaining items skipped

Current Score: 78% (was 65%, +13%)
```

### Validation Failed

```
âŒ Error: Completion succeeded but validation failed

Updates Applied Successfully:
  âœ… Terraform module created
  âœ… Research docs generated
  âœ… Examples enhanced

Validation Results:
  âœ… Build passed (make build)
  âŒ Tests failed (make test)

Test Failures:
  1. spec_test.go:45 - Validation test failed
     Error: expected true, got false

Recommendation:
  Fix test failures manually, then re-run:
  @complete-project-planton-component MongodbAtlas

Current Score: 95% (validation issues don't affect score)
```

## Safety Features

### Dry-Run Mode

Preview entire workflow without changes:

```bash
@complete-project-planton-component MongodbAtlas --dry-run
```

**Shows:**
- Current audit results
- All gaps that would be filled
- Forge rules that would run
- Estimated time and file count
- Expected final score
- No files modified

### Incremental Progress

Even if completion fails partway:
- Audit reports are saved (historical tracking)
- Files created up to failure point remain
- Can resume from failure with manual update
- Progress is not lost

### Validation Checkpoints

Validates after major changes:
- After proto regeneration â†’ verify build
- After IaC creation â†’ verify tests
- After doc generation â†’ verify examples
- Final validation â†’ verify everything

### Conservative Target

Default target is **95% not 100%**:
- 100% includes nice-to-have items that aren't critical
- 95% ensures all critical and important items present
- Reaching 95% takes 15-20 min, 100% might take 30-45 min
- You can override with `--target-score 100` if perfection needed

## Comparison to Manual Workflow

### Manual Workflow (Traditional)

```bash
# Step 1: Check status
@audit-project-planton-component MongodbAtlas
# Read report, identify gaps

# Step 2: Fill gaps
@update-project-planton-component MongodbAtlas --scenario fill-gaps
# Monitor progress, handle errors

# Step 3: Verify
@audit-project-planton-component MongodbAtlas
# Check score improved

# Total: 3 commands, manual monitoring
```

### Complete Workflow (Automated)

```bash
# Single command
@complete-project-planton-component MongodbAtlas

# Automatically:
# - Audits current state
# - Identifies gaps
# - Fills gaps
# - Re-audits to verify
# - Reports before/after

# Total: 1 command, automatic
```

**Time Savings:** 2-3 minutes saved on workflow overhead

## Use Cases

### Use Case 1: Onboarding Legacy Components

```bash
# You have 20 old components at 60-70% completion
# Systematically complete them all

for component in OldComponent1 OldComponent2 ... OldComponent20; do
  @complete-project-planton-component $component
done

# Each component automatically brought to 95%+
# Historical audit reports track improvement
```

### Use Case 2: Quality Gate Before Release

```bash
# Before release, ensure all components meet standards
@complete-project-planton-component CriticalComponent

# If it was <95%, gaps are filled automatically
# If it was â‰¥95%, confirms it's ready
# Either way, you know it's production-ready
```

### Use Case 3: Forge Follow-Up

```bash
# Forge might create component at 85% (if some rules fail)
@forge-project-planton-component NewComponent --provider aws

# Automatically complete it
@complete-project-planton-component NewComponent

# Result: 100% complete component
```

### Use Case 4: Rapid Improvement

```bash
# Need to quickly improve component for demo/release
@complete-project-planton-component DemoComponent

# One command, 15-20 minutes, done!
# No need to manually identify and fill gaps
```

## Integration with Other Rules

### After Forge

```bash
# Create component (might be 90-95%)
@forge-project-planton-component NewComponent --provider aws

# Complete to 100%
@complete-project-planton-component NewComponent

# Result: Guaranteed 95%+ completion
```

### Instead of Audit â†’ Update

```bash
# Manual workflow
@audit-project-planton-component MongodbAtlas
@update-project-planton-component MongodbAtlas --scenario fill-gaps
@audit-project-planton-component MongodbAtlas

# Automated workflow (equivalent)
@complete-project-planton-component MongodbAtlas
```

### Before Delete

```bash
# Check if component is worth completing
@complete-project-planton-component OldComponent --dry-run

# If shows: "Need to create 15 files, 2 hours work"
# Decision: Not worth it, delete instead
@delete-project-planton-component OldComponent --backup

# If shows: "Need to create 3 files, 10 minutes"
# Decision: Worth completing
@complete-project-planton-component OldComponent
```

## Progress Tracking

Complete provides detailed progress through all phases:

```
ğŸ¯ Complete: MongodbAtlas

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Step 1/3: Initial Audit
â”œâ”€ Analyzing component structure
â”œâ”€ Checking 9 categories
â””â”€ Score: 65% (Partially Complete)

Gaps to Fill:
  âŒ Terraform module (4.44%)
  âŒ Research docs (13.34%)
  âŒ Pulumi overview (5%)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Step 2/3: Filling Gaps
â”œâ”€ Reading v1/docs/README.md for context... (if exists)
â”œâ”€ Running forge rules to fill gaps...

Phase 1: Terraform Module
  [1/7] âœ… variables.tf
  [2/7] âœ… provider.tf
  [3/7] âœ… locals.tf
  [4/7] âœ… main.tf
  [5/7] âœ… outputs.tf
  [6/7] âœ… README.md
  [7/7] âœ… validation

Phase 2: Documentation
  [8/9] âœ… Research docs (850 lines)
  [9/9] âœ… Pulumi overview

Phase 3: Validation
  [10/11] âœ… Component tests passed (spec_test.go)
  [11/12] âœ… Build passed (make build)
  [12/12] âœ… Full test suite passed (make test)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Step 3/3: Final Verification
â””â”€ Score: 98% âœ…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… Completion Successful!

Summary:
  Before: 65% â†’ After: 98%
  Improvement: +33%
  Duration: 18 minutes
  Files Created: 12
  
Audit Trail:
  ğŸ“Š Initial: v1/docs/audit/2025-11-13-094500.md
  ğŸ“Š Final: v1/docs/audit/2025-11-13-094530.md
```

## Best Practices

### When to Use Complete

âœ… **Use complete when:**
- You want automatic gap-filling
- Component is <95% complete
- You trust automatic improvements
- Time is more valuable than control
- Multiple components need improvement

âœ… **Use manual audit/update when:**
- You want to review gaps before filling
- You need selective improvements (only some gaps)
- You want to customize the update process
- You prefer step-by-step control

### Before Running Complete

1. **Commit current changes** - Clean git state
2. **Know the component** - Understand its purpose
3. **Check disk space** - Documentation generation can be large
4. **Allocate time** - 15-30 minutes for typical completion

### After Running Complete

1. **Review generated files** - Don't blindly trust automation
2. **Test deployment** - Use iac/hack/manifest.yaml
3. **Review audit reports** - Compare before/after
4. **Commit changes** - With meaningful commit message
5. **Share results** - Show improvement metrics to team

## Troubleshooting

### "Component already complete"

```
âœ… Component is already at 98% (target is 95%)

No gaps to fill. Component is production-ready!
```

**Action:** None needed, or lower target score if you want to reach 100%.

### "Failed to reach target score"

```
âš ï¸  Partial completion: Reached 88% (target was 95%)

Some gaps could not be filled automatically:
  âŒ Rule 020 failed (research docs)
  
Recommendation:
  Run manual update with specific scenario:
  @update-project-planton-component MongodbAtlas --scenario refresh-docs
```

**Action:** Use manual update to fix specific failures.

### "Completion took too long"

**Typical durations:**
- Few gaps (1-3 items): 5-10 minutes
- Moderate gaps (4-6 items): 15-20 minutes
- Many gaps (7+ items): 25-35 minutes

**If stuck:**
- Check progress messages
- Wait for timeout (rules retry up to 3 times)
- Cancel if needed (Ctrl+C)
- Resume manually with update rule

## Success Criteria

After complete finishes successfully:

âœ… Component score â‰¥ target (default 95%)
âœ… All critical gaps filled
âœ… All important gaps filled (unless target <95%)
âœ… spec_test.go exists with validation tests
âœ… Component tests execute and pass (`go test ./apis/.../v1/`)
âœ… Build validation passed (`make build`)
âœ… Full test suite passed (`make test`)
âœ… Two audit reports generated (before/after)
âœ… Summary report shows improvement
âœ… Files ready to commit

**Critical:** Tests must pass for component to be considered complete. The complete operation validates test execution as part of the workflow.

## Examples

### Example 1: Complete Incomplete Component

```bash
@complete-project-planton-component MongodbAtlas

# Before: 65% (missing Terraform, docs)
# Process: 18 minutes
# After: 98% (fully complete)
# Created: 12 files
```

### Example 2: Already Complete

```bash
@complete-project-planton-component GcpCertManagerCert

# Current: 98%
# Action: None (already â‰¥95%)
# Duration: 30 seconds (audit only)
```

### Example 3: Preview Mode

```bash
@complete-project-planton-component PostgresKubernetes --dry-run

# Shows what would be created
# Estimates time and file count
# No changes made
```

### Example 4: Custom Target

```bash
@complete-project-planton-component AwsRdsInstance --target-score 90

# Stops at 90% instead of 95%
# Might skip some nice-to-have items
# Faster completion
```

### Example 5: Batch Processing

```bash
# Complete multiple components
for component in Component1 Component2 Component3; do
  echo "Completing $component..."
  @complete-project-planton-component $component
  echo "---"
done

# Each brought to 95%+
# Audit reports track all improvements
```

## Reference

- **Ideal State:** `architecture/deployment-component.md`
- **Audit Rule:** `.cursor/rules/deployment-component/audit/audit-project-planton-component.mdc`
- **Update Rule:** `.cursor/rules/deployment-component/update/update-project-planton-component.mdc`
- **Complete README:** `.cursor/rules/deployment-component/complete/README.md`

## Notes

- Complete is a **convenience wrapper** around audit + update
- For fine-grained control, use audit and update separately
- Complete always uses update --fill-gaps (doesn't support other scenarios)
- If you need specific updates, use update rule directly
- Complete is idempotent (running multiple times is safe)
- Each run creates new audit report (historical tracking)

---

**Ready to complete?** Run `@complete-project-planton-component <ComponentName>` for one-command improvement!