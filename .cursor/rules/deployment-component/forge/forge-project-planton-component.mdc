---
alwaysApply: false
---

# Forge: Create Complete Deployment Component

## Purpose

This orchestrator rule scaffolds a **complete deployment component** from scratch, following the ideal state defined in `architecture/deployment-component.md`.

## Role

You are the Project Planton Code Partner. This rule orchestrates all forge flow rules to create a production-ready, fully-documented deployment component that matches the ideal state checklist.

## What Forge Creates

A complete deployment component includes:

âœ… **Proto API Definitions** - All 4 proto files with validations and tests
âœ… **IaC Modules** - Both Pulumi and Terraform with feature parity  
âœ… **Documentation** - User-facing, research, and technical docs
âœ… **Supporting Files** - Test manifests, debug scripts, build configs
âœ… **Registry Entry** - Registered in cloud_resource_kind.proto
âœ… **Validation** - Build and test validation passed

**Result:** 95-100% completion score when audited against ideal state!

## Usage

```
@forge-project-planton-component <ComponentName> --provider <provider>
```

**Examples:**
```
@forge-project-planton-component MongodbAtlas --provider atlas
@forge-project-planton-component GcpCertManagerCert --provider gcp
@forge-project-planton-component PostgresKubernetes --provider kubernetes --category workload
```

## Execution Sequence

The following 21 rules execute in order. Each rule is atomic and can be run individually if needed.

### Phase 1: Proto API Definitions (Rules 001-006)

1. **001-spec-proto** - Generate spec.proto (minimal schema, no validations)
2. **002-spec-validate** - Add buf.validate rules and CEL validations
3. **003-spec-tests** - Generate spec_test.go with validation tests
4. **004-stack-outputs** - Generate stack_outputs.proto (deployment outputs)
5. **005-api** - Generate api.proto (KRM wiring: metadata/spec/status)
6. **006-stack-input** - Generate stack_input.proto (inputs to IaC modules)

### Phase 2: Registration and Stubs (Rules 016-017)

7. **016-cloud-resource-kind** - Add enum entry to cloud_resource_kind.proto
8. **017-generate-proto-stubs** - Generate .pb.go stubs (make protos)

### Phase 3: Documentation (Rules 007, 020)

9. **007-docs** - Generate v1/README.md (user-facing) and v1/examples.md
10. **020-research-docs** - Generate v1/docs/README.md (comprehensive research)

### Phase 4: Supporting Files (Rule 008)

11. **008-hack-manifest** - Generate iac/hack/manifest.yaml (test manifest)

### Phase 5: Pulumi Implementation (Rules 009-012, 021)

12. **009-pulumi-module** - Generate module/ (main.go, locals.go, outputs.go, resources)
13. **010-pulumi-entrypoint** - Generate entrypoint (main.go, Pulumi.yaml, Makefile)
14. **011-pulumi-e2e** - Run Pulumi E2E test (validate deployment works)
15. **012-pulumi-docs** - Generate iac/pulumi/README.md and debug.sh
16. **021-pulumi-overview** - Generate iac/pulumi/overview.md (architecture)

### Phase 6: Terraform Implementation (Rules 013-015)

17. **013-terraform-module** - Generate tf/ (variables.tf, main.tf, locals.tf, outputs.tf, provider.tf)
18. **014-terraform-e2e** - Run Terraform E2E test (validate deployment works)
19. **015-terraform-docs** - Generate iac/tf/README.md

### Phase 7: Final Validation (Rules 018-019)

20. **018-build-validation** - Run make build (verify Go code compiles)
21. **019-test-validation** - Run make test (verify all tests pass)
    - Includes component-specific test: `go test ./apis/.../v1/`
    - Validates spec_test.go tests all buf.validate rules
    - Ensures validation rules are syntactically and semantically correct

## Error Handling

- Each rule retries up to 3 times on fixable errors
- Build/compilation errors are fixed automatically when possible
- If a rule fails after 3 attempts, the process stops with clear error message
- You can resume from the failed rule after fixing issues

## Progress Tracking

The orchestrator provides progress updates:
```
[1/21] âœ… Generated spec.proto
[2/21] âœ… Added validations
[3/21] âœ… Generated tests
...
[21/21] âœ… All tests passed

ðŸŽ‰ Component creation complete!
Run @audit-project-planton-component to verify 100% ideal state compliance.
```

## Post-Forge Validation

After forge completes, validate the component:

```
@audit-project-planton-component <ComponentName>
```

Expected result: **95-100% completion score**

If score is lower, the audit report will identify gaps and suggest fixes.

## Reference

- **Ideal State Definition:** `architecture/deployment-component.md`
- **Individual Flow Rules:** `.cursor/rules/deployment-component/forge/flow/`
- **Analysis:** `.cursor/rules/deployment-component/forge/FORGE_ANALYSIS.md`

## Notes

- All steps run non-interactively (no user input required)
- Uses local backends by default (Pulumi local, Terraform local)
- Generated code follows Project Planton conventions
- Both IaC implementations have feature parity
- All documentation is substantial and production-ready
- Component is immediately usable after forge completes

## Success Criteria

After forge completes, the component should have:

âœ… All 4 proto files with validations
âœ… Generated .pb.go stubs
âœ… spec_test.go with validation tests
âœ… **Component tests execute and pass** (validates buf.validate rules)
âœ… Registered in cloud_resource_kind.proto
âœ… Complete user-facing documentation (README.md, examples.md)
âœ… Comprehensive research documentation (docs/README.md)
âœ… Pulumi module that compiles and works
âœ… Terraform module that validates and works
âœ… Supporting files (manifests, debug scripts, module overviews)
âœ… Build validation passed (`make build`)
âœ… Full test validation passed (`make test`)

**Result:** A production-ready deployment component matching 95-100% of ideal state with all tests passing!