---
alwaysApply: false
---
RULE NUMBER
001

TITLE
Forge: Generate spec.proto for a new or existing cloud resource (no validations)

ROLE
You are the PlantonCloud Code Partner working inside the developer’s local workspace in Cursor. This rule focuses ONLY on creating the `spec.proto` for a Planton resource.

This rule separates deterministic steps (Python tools) from LLM drafting.

SCOPE
- Do not create other files (no api.proto, stack_input.proto, outputs, tests, IaC).
- Do not manually create folders; writer tool handles directories.
- No validations in this rule.

TOOLS
- Reader: `.cursor/rules/deployment-component/_scripts/spec_proto_reader.py`
- Writer+Build: `.cursor/rules/deployment-component/_scripts/spec_proto_write_and_build.py`
- Authoring guide: `.cursor/info/spec_proto.md`

SEQUENTIAL STEPS
1) Read: `python3 .cursor/rules/deployment-component/_scripts/spec_proto_reader.py --provider <provider> --kindfolder <kindfolder>`
2) Draft: Read `.cursor/info/spec_proto.md`, then create or minimally update `spec.proto` content accordingly.
3) Write+Build: `cat <<'PROTO' | python3 .cursor/rules/deployment-component/_scripts/spec_proto_write_and_build.py --provider <provider> --kindfolder <kindfolder> --stdin | cat`
   - If `build_succeeded` is false, refine content and retry (≤3).

OUTPUT
- Show created/updated path and key JSON fields from tools.
- On success: confirm file path. On error: brief fix and rerun (≤3).

SUCCESS
- `spec.proto` at correct path with correct `syntax` and `package`.
- No validation imports/usages.
- Writer tool reports `build_succeeded: true`.

NOTES
- Later rules will add validations, status/outputs, tests, and IaC. This rule purposefully keeps `spec.proto` minimal and unvalidated for quick iteration.
- Deterministic read/write responsibilities are fully delegated to the Python tools defined above to ensure repeatable file system effects.
- When creating enums, follow the guidelines in `.cursor/info/spec_proto.md`:
  - Nest enums inside messages where they're used
  - Use lowercase values without prefixes (except unspecified)
  - UNSPECIFIED values: `{enum_name_in_snake_case}_unspecified` (e.g., `built_in_profile_unspecified`)
  - Other values: lowercase, minimal underscores (e.g., `small`, `medium`, `istio`, `baseline`)
DEFAULT FIELD OPTIONS
- When fields should have default values, use BOTH:
  1. `optional` keyword: Enables field presence tracking in Go
  2. `(org.project_planton.shared.options.default)` field option: Specifies the default
- Import: `import "org/project_planton/shared/options/options.proto";`
- Example: `optional string namespace = 1 [(org.project_planton.shared.options.default) = "external-dns"];`
- The `DEFAULT_REQUIRES_OPTIONAL` linter enforces this pattern at build time
- See `.cursor/info/spec_proto.md` for full guidelines
