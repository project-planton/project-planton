// Code generated by project-planton scaffolder. DO NOT EDIT.
//
// This file contains helper logic for building a scoped Pulumi AWS provider
// instance from the credential specification passed in the stack-input.

package module

import (
    "github.com/pkg/errors"
    "github.com/pulumi/pulumi-aws/sdk/v6/go/aws"
    "github.com/pulumi/pulumi/sdk/v3/go/pulumi"

    awscredsv1 "github.com/project-planton/project-planton/apis/project/planton/credential/awscredential/v1"
)

// buildAWSProvider creates an aws.Provider using the values coming from the
// AwsCredentialSpec message.
func buildAWSProvider(ctx *pulumi.Context, spec *awscredsv1.AwsCredentialSpec) (*aws.Provider, error) {
    if spec == nil {
        return nil, errors.New("aws credential spec must be provided")
    }

    region := spec.GetRegion()
    if region == "" {
        return nil, errors.New("aws credential spec: region must be specified")
    }

    args := &aws.ProviderArgs{
        Region: pulumi.StringPtr(region),
    }

    if ak := spec.GetAccessKeyId(); ak != "" {
        args.AccessKey = pulumi.StringPtr(ak)
    }
    if sk := spec.GetSecretAccessKey(); sk != "" {
        args.SecretKey = pulumi.StringPtr(sk)
    }
    if tok := spec.GetSessionToken(); tok != "" {
        args.Token = pulumi.StringPtr(tok)
    }
    if profile := spec.GetProfile(); profile != "" {
        args.Profile = pulumi.StringPtr(profile)
    }

    provider, err := aws.NewProvider(ctx, "aws", args)
    if err != nil {
        return nil, errors.Wrap(err, "creating AWS provider")
    }

    return provider, nil
}
