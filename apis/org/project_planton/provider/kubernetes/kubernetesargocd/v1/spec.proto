syntax = "proto3";

package org.project_planton.provider.kubernetes.kubernetesargocd.v1;

import "buf/validate/validate.proto";
import "org/project_planton/provider/kubernetes/kubernetes.proto";
import "org/project_planton/provider/kubernetes/options.proto";

// **KubernetesArgocdSpec** defines the configuration for deploying Argo CD on a Kubernetes cluster.
// This message specifies the parameters needed to create and manage an Argo CD deployment within a Kubernetes environment.
// It includes container specifications and ingress settings to control resource allocation and external access.
message KubernetesArgocdSpec {
  // The container specifications for the Argo CD deployment.
  KubernetesArgocdContainer container = 1 [(buf.validate.field).required = true];

  // The ingress configuration for the Argo CD deployment.
  KubernetesArgocdIngress ingress = 3;
}

/**
 * KubernetesArgocdIngress defines ingress configuration for Argo CD.
 */
message KubernetesArgocdIngress {
  // Flag to enable or disable ingress.
  // When enabled, creates appropriate ingress resources for external access.
  bool enabled = 1;

  // The full hostname for external access (e.g., "argocd.example.com").
  // Required when enabled is true.
  string hostname = 2;

  option (buf.validate.message).cel = {
    id: "spec.ingress.hostname.required"
    expression: "!this.enabled || size(this.hostname) > 0"
    message: "hostname is required when ingress is enabled"
  };
}

// **KubernetesArgocdContainer** specifies the container configuration for the Argo CD application.
// It includes resource allocations for CPU and memory to ensure the application runs efficiently.
// Recommended defaults: CPU requests - 50m, Memory requests - 256Mi, CPU limits - 1, Memory limits - 1Gi.
message KubernetesArgocdContainer {
  // The CPU and memory resources allocated to the Argo CD container.
  org.project_planton.provider.kubernetes.ContainerResources resources = 1 [(org.project_planton.provider.kubernetes.default_container_resources) = {
    limits: {
      cpu: "1000m"
      memory: "1Gi"
    }
    requests: {
      cpu: "50m"
      memory: "100Mi"
    }
  }];
}
