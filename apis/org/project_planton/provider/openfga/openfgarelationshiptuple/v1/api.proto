syntax = "proto3";

package org.project_planton.provider.openfga.openfgarelationshiptuple.v1;

import "buf/validate/validate.proto";
import "org/project_planton/provider/openfga/openfgarelationshiptuple/v1/spec.proto";
import "org/project_planton/provider/openfga/openfgarelationshiptuple/v1/stack_outputs.proto";
import "org/project_planton/shared/metadata.proto";

// OpenFgaRelationshipTuple is a deployment component that creates a relationship tuple in OpenFGA.
//
// A relationship tuple is the fundamental unit of authorization data in OpenFGA. It represents
// a relationship between a user (or userset) and an object through a specific relation. When
// combined with an authorization model, tuples determine access decisions.
//
// Key concepts:
// - User: The subject being granted access (user:anne, group:engineering#member, user:*)
// - Relation: The type of relationship (viewer, editor, owner, member, admin)
// - Object: The resource being accessed (document:budget, folder:reports)
// - Condition: Optional dynamic rules evaluated at check time
//
// IMPORTANT: Relationship tuples are immutable. Changing any field creates a new tuple and
// deletes the old one (Terraform handles this automatically).
//
// IMPORTANT: OpenFGA only has a Terraform provider - there is no Pulumi provider available.
// This component must be deployed using Terraform/Tofu as the provisioner.
// The Pulumi module is a pass-through placeholder that does not create resources.
//
// Use cases:
// - Grant a user access to a specific document
// - Add a user to a group or organization
// - Create hierarchical relationships (folder contains document)
// - Implement role-based access with conditions
//
// Example manifest:
// ```yaml
// apiVersion: open-fga.project-planton.org/v1
// kind: OpenFgaRelationshipTuple
// metadata:
//   name: anne-views-budget
//   org: my-organization
//   env: production
// spec:
//   storeId: "01HXYZ..."
//   user: "user:anne"
//   relation: "viewer"
//   object: "document:budget-2024"
// ```
message OpenFgaRelationshipTuple {
  // api_version is the version of the OpenFGA API resource.
  // Must be "open-fga.project-planton.org/v1" for this version.
  string api_version = 1 [(buf.validate.field).string.const = 'open-fga.project-planton.org/v1'];

  // kind is the Kubernetes Resource Model (KRM) kind.
  // Must be "OpenFgaRelationshipTuple" for this resource type.
  string kind = 2 [(buf.validate.field).string.const = 'OpenFgaRelationshipTuple'];

  // metadata contains standard cloud resource metadata.
  // - name: Unique identifier for the tuple within Project Planton
  // - org: Organization that owns this tuple
  // - env: Environment (development, staging, production)
  // - labels: Key-value pairs for filtering and organization
  org.project_planton.shared.CloudResourceMetadata metadata = 3 [(buf.validate.field).required = true];

  // spec contains the desired configuration for the OpenFGA relationship tuple.
  // Includes the store ID, user, relation, object, and optional condition.
  OpenFgaRelationshipTupleSpec spec = 4 [(buf.validate.field).required = true];

  // status contains the current state of the OpenFGA relationship tuple.
  // This is populated by the system after deployment and includes
  // the confirmed tuple fields.
  OpenFgaRelationshipTupleStatus status = 5;
}

// OpenFgaRelationshipTupleStatus represents the current state of an OpenFGA Relationship Tuple resource.
// This is populated by the deployment system and contains read-only outputs.
message OpenFgaRelationshipTupleStatus {
  // outputs contains the stack outputs from the OpenFGA relationship tuple deployment.
  // These values are populated after successful deployment and confirm
  // the tuple was created.
  OpenFgaRelationshipTupleStackOutputs outputs = 1;
}
