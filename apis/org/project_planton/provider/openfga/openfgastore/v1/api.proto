syntax = "proto3";

package org.project_planton.provider.openfga.openfgastore.v1;

import "buf/validate/validate.proto";
import "org/project_planton/provider/openfga/openfgastore/v1/spec.proto";
import "org/project_planton/provider/openfga/openfgastore/v1/stack_outputs.proto";
import "org/project_planton/shared/metadata.proto";

// OpenFgaStore is a deployment component that creates a store in OpenFGA.
//
// A store is the top-level container for authorization data in OpenFGA. Each store
// contains authorization models (which define the relationships and permissions)
// and relationship tuples (which represent the actual authorization data).
//
// IMPORTANT: OpenFGA only has a Terraform provider - there is no Pulumi provider available.
// This component must be deployed using Terraform/Tofu as the provisioner.
// The Pulumi module is a pass-through placeholder that does not create resources.
//
// Use cases:
// - Create isolated authorization stores for different environments (dev/staging/prod)
// - Separate authorization data for different applications or tenants
// - Manage authorization infrastructure as code
//
// Example manifest:
// ```yaml
// apiVersion: openfga.project-planton.org/v1
// kind: OpenFgaStore
// metadata:
//   name: production-authz
//   org: my-organization
//   env: production
// spec:
//   name: production-authorization-store
// ```
message OpenFgaStore {
  // api_version is the version of the OpenFGA API resource.
  // Must be "open-fga.project-planton.org/v1" for this version.
  string api_version = 1 [(buf.validate.field).string.const = 'open-fga.project-planton.org/v1'];

  // kind is the Kubernetes Resource Model (KRM) kind.
  // Must be "OpenFgaStore" for this resource type.
  string kind = 2 [(buf.validate.field).string.const = 'OpenFgaStore'];

  // metadata contains standard cloud resource metadata.
  // - name: Unique identifier for the store within Project Planton
  // - org: Organization that owns this store
  // - env: Environment (development, staging, production)
  // - labels: Key-value pairs for filtering and organization
  org.project_planton.shared.CloudResourceMetadata metadata = 3 [(buf.validate.field).required = true];

  // spec contains the desired configuration for the OpenFGA store.
  // Currently only the store name is configurable.
  OpenFgaStoreSpec spec = 4 [(buf.validate.field).required = true];

  // status contains the current state of the OpenFGA store.
  // This is populated by the system after deployment and includes
  // the store ID and other runtime information.
  OpenFgaStoreStatus status = 5;
}

// OpenFgaStoreStatus represents the current state of an OpenFGA Store resource.
// This is populated by the deployment system and contains read-only outputs.
message OpenFgaStoreStatus {
  // outputs contains the stack outputs from the OpenFGA store deployment.
  // These values are populated after successful deployment and include
  // the store identifier.
  OpenFgaStoreStackOutputs outputs = 1;
}
