# OpenFgaAuthorizationModel Test Manifest
#
# This manifest is used for testing the OpenFGA Authorization Model deployment component.
#
# Prerequisites:
# - OpenFGA server running (locally or cloud-hosted)
# - OpenFGA credentials configured
# - An existing OpenFGA store (store_id from OpenFgaStore deployment)
#
# Usage with Terraform/Tofu (required - no Pulumi provider available):
#   project-planton apply --manifest manifest.yaml \
#     --openfga-provider-config /path/to/openfga-creds.yaml \
#     --provisioner tofu
#
# Example OpenFGA credentials file (openfga-creds.yaml):
#   apiUrl: http://localhost:8080
#   # For token auth:
#   apiToken: your-api-token
#   # Or for client credentials:
#   # clientId: your-client-id
#   # clientSecret: your-client-secret
#   # apiTokenIssuer: https://your-issuer/oauth/token

apiVersion: open-fga.project-planton.org/v1
kind: OpenFgaAuthorizationModel
metadata:
  name: test-model
  org: planton-cloud
  env: development
spec:
  # Replace with actual store ID from OpenFgaStore deployment
  storeId: "01HXYZ_REPLACE_WITH_ACTUAL_STORE_ID"
  # Example authorization model with user and document types
  modelJson: |
    {
      "schema_version": "1.1",
      "type_definitions": [
        {
          "type": "user",
          "relations": {}
        },
        {
          "type": "document",
          "relations": {
            "viewer": {
              "this": {}
            },
            "editor": {
              "this": {}
            },
            "owner": {
              "this": {}
            }
          },
          "metadata": {
            "relations": {
              "viewer": {
                "directly_related_user_types": [
                  {"type": "user"}
                ]
              },
              "editor": {
                "directly_related_user_types": [
                  {"type": "user"}
                ]
              },
              "owner": {
                "directly_related_user_types": [
                  {"type": "user"}
                ]
              }
            }
          }
        }
      ]
    }
