syntax = "proto3";

package org.project_planton.provider.openfga.openfgaauthorizationmodel.v1;

import "buf/validate/validate.proto";

// OpenFgaAuthorizationModelSpec defines the configuration for an OpenFGA Authorization Model.
//
// An authorization model defines the types, relations, and conditions that govern access control
// within an OpenFGA store. Each store can have multiple authorization models, with each new model
// being a complete replacement (not a patch) of the type definitions.
//
// The model is specified in JSON format and includes:
// - Type definitions: Define object types and their relations
// - Conditions (optional): Define dynamic conditions for access decisions
//
// IMPORTANT: Authorization models are immutable in OpenFGA. Creating a new model creates a new
// version. The model_json change will trigger a replacement (new model ID).
//
// IMPORTANT: OpenFGA only has a Terraform provider - there is no Pulumi provider available.
// This component must use Terraform/Tofu as the provisioner.
//
// Reference:
// - Terraform: https://registry.terraform.io/providers/openfga/openfga/latest/docs/resources/authorization_model
// - OpenFGA Docs: https://openfga.dev/docs/concepts#what-is-an-authorization-model
message OpenFgaAuthorizationModelSpec {
  // store_id is the unique identifier of the OpenFGA store where this model will be created.
  //
  // This ID is obtained from an OpenFgaStore deployment or from an existing store.
  // The store must exist before creating an authorization model.
  //
  // Note: The store_id is immutable - changing it requires replacing the model.
  //
  // Example: "01HXYZ..."
  string store_id = 1 [(buf.validate.field).required = true];

  // model_json is the authorization model definition in JSON format.
  //
  // The JSON must conform to the OpenFGA authorization model schema and include:
  // - schema_version: The schema version (e.g., "1.1")
  // - type_definitions: Array of type definitions with name, relations, and metadata
  // - conditions (optional): Map of conditions for dynamic access decisions
  //
  // Note: The model is immutable - changing it requires replacing the model (new ID).
  //
  // Tip: Use the openfga_authorization_model_document data source in Terraform to convert
  // DSL format to JSON, or use the OpenFGA CLI to validate models before deployment.
  //
  // Example:
  // {
  //   "schema_version": "1.1",
  //   "type_definitions": [
  //     {
  //       "type": "user",
  //       "relations": {}
  //     },
  //     {
  //       "type": "document",
  //       "relations": {
  //         "viewer": {
  //           "this": {}
  //         },
  //         "editor": {
  //           "this": {}
  //         },
  //         "owner": {
  //           "this": {}
  //         }
  //       },
  //       "metadata": {
  //         "relations": {
  //           "viewer": {"directly_related_user_types": [{"type": "user"}]},
  //           "editor": {"directly_related_user_types": [{"type": "user"}]},
  //           "owner": {"directly_related_user_types": [{"type": "user"}]}
  //         }
  //       }
  //     }
  //   ]
  // }
  string model_json = 2 [(buf.validate.field).required = true];
}
