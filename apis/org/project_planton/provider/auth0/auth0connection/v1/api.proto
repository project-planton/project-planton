syntax = "proto3";

package org.project_planton.provider.auth0.auth0connection.v1;

import "buf/validate/validate.proto";
import "org/project_planton/provider/auth0/auth0connection/v1/spec.proto";
import "org/project_planton/provider/auth0/auth0connection/v1/stack_outputs.proto";
import "org/project_planton/shared/metadata.proto";

// Auth0Connection is a deployment component that configures an identity connection in Auth0.
// Connections are the bridge between Auth0 and identity sources, enabling users to authenticate
// using various methods including databases, social providers, and enterprise identity providers.
//
// This component supports:
// - Database connections (Auth0's hosted user database)
// - Social connections (Google, Facebook, GitHub, LinkedIn, etc.)
// - Enterprise connections (SAML, OIDC, Azure AD/Entra ID)
//
// Example manifest:
// ```yaml
// apiVersion: auth0.project-planton.org/v1
// kind: Auth0Connection
// metadata:
//   name: google-social-login
//   org: my-organization
//   env: production
// spec:
//   strategy: google-oauth2
//   display_name: Sign in with Google
//   enabled_clients:
//     - "abc123def456"
//   social_options:
//     client_id: "your-google-client-id.apps.googleusercontent.com"
//     client_secret: "your-google-client-secret"
//     scopes:
//       - openid
//       - profile
//       - email
// ```
message Auth0Connection {
  // api_version is the version of the Auth0 API resource.
  // Must be "auth0.project-planton.org/v1" for this version.
  string api_version = 1 [(buf.validate.field).string.const = 'auth0.project-planton.org/v1'];

  // kind is the Kubernetes Resource Model (KRM) kind.
  // Must be "Auth0Connection" for this resource type.
  string kind = 2 [(buf.validate.field).string.const = 'Auth0Connection'];

  // metadata contains standard cloud resource metadata.
  // - name: Unique identifier for the connection within Project Planton
  // - org: Organization that owns this connection
  // - env: Environment (development, staging, production)
  // - labels: Key-value pairs for filtering and organization
  org.project_planton.shared.CloudResourceMetadata metadata = 3 [(buf.validate.field).required = true];

  // spec contains the desired configuration for the Auth0 connection.
  // This includes the connection strategy, authentication options, and provider-specific settings.
  Auth0ConnectionSpec spec = 4 [(buf.validate.field).required = true];

  // status contains the current state of the Auth0 connection.
  // This is populated by the system after deployment and includes
  // connection identifiers, callback URLs, and other runtime information.
  Auth0ConnectionStatus status = 5;
}

// Auth0ConnectionStatus represents the current state of an Auth0 Connection resource.
// This is populated by the deployment system and contains read-only outputs.
message Auth0ConnectionStatus {
  // outputs contains the stack outputs from the Auth0 connection deployment.
  // These values are populated after successful deployment and include
  // resource identifiers, callback URLs, and other important reference information.
  Auth0ConnectionStackOutputs outputs = 1;
}
