syntax = "proto3";

package org.project_planton.provider.auth0.auth0eventstream.v1;

import "buf/validate/validate.proto";
import "org/project_planton/provider/auth0/auth0eventstream/v1/spec.proto";
import "org/project_planton/provider/auth0/auth0eventstream/v1/stack_outputs.proto";
import "org/project_planton/shared/metadata.proto";

// Auth0EventStream is a deployment component that configures an Event Stream in Auth0.
// Event Streams enable real-time delivery of Auth0 events to external systems like
// AWS EventBridge or custom webhook endpoints.
//
// Use cases:
// - Stream authentication events to a SIEM system for security monitoring
// - Trigger workflows when users are created or updated
// - Build real-time dashboards for login analytics
// - Integrate Auth0 events with AWS Lambda for serverless processing
//
// Example manifest for EventBridge:
// ```yaml
// apiVersion: auth0.project-planton.org/v1
// kind: Auth0EventStream
// metadata:
//   name: security-events
//   org: my-organization
//   env: production
// spec:
//   destination_type: eventbridge
//   subscriptions:
//     - user.created
//     - user.updated
//     - authentication.success
//     - authentication.failure
//   eventbridge_configuration:
//     aws_account_id: "123456789012"
//     aws_region: us-east-1
// ```
//
// Example manifest for Webhook:
// ```yaml
// apiVersion: auth0.project-planton.org/v1
// kind: Auth0EventStream
// metadata:
//   name: user-events-webhook
//   org: my-organization
//   env: production
// spec:
//   destination_type: webhook
//   subscriptions:
//     - user.created
//     - user.updated
//     - user.deleted
//   webhook_configuration:
//     webhook_endpoint: "https://api.example.com/webhooks/auth0"
//     webhook_authorization:
//       method: bearer
//       token: "your-secret-token"
// ```
message Auth0EventStream {
  // api_version is the version of the Auth0 API resource.
  // Must be "auth0.project-planton.org/v1" for this version.
  string api_version = 1 [(buf.validate.field).string.const = 'auth0.project-planton.org/v1'];

  // kind is the Kubernetes Resource Model (KRM) kind.
  // Must be "Auth0EventStream" for this resource type.
  string kind = 2 [(buf.validate.field).string.const = 'Auth0EventStream'];

  // metadata contains standard cloud resource metadata.
  // - name: Unique identifier for the event stream within Project Planton (becomes stream name)
  // - org: Organization that owns this event stream
  // - env: Environment (development, staging, production)
  // - labels: Key-value pairs for filtering and organization
  org.project_planton.shared.CloudResourceMetadata metadata = 3 [(buf.validate.field).required = true];

  // spec contains the desired configuration for the Auth0 event stream.
  // This includes destination type, subscriptions, and destination-specific configuration.
  Auth0EventStreamSpec spec = 4 [(buf.validate.field).required = true];

  // status contains the current state of the Auth0 event stream.
  // This is populated by the system after deployment and includes
  // identifiers, status, and other runtime information.
  Auth0EventStreamStatus status = 5;
}

// Auth0EventStreamStatus represents the current state of an Auth0 Event Stream resource.
// This is populated by the deployment system and contains read-only outputs.
message Auth0EventStreamStatus {
  // outputs contains the stack outputs from the Auth0 event stream deployment.
  // These values are populated after successful deployment and include
  // identifiers, status, and destination-specific information.
  Auth0EventStreamStackOutputs outputs = 1;
}
