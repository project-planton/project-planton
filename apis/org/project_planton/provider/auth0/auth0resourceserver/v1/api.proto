syntax = "proto3";

package org.project_planton.provider.auth0.auth0resourceserver.v1;

import "buf/validate/validate.proto";
import "org/project_planton/provider/auth0/auth0resourceserver/v1/spec.proto";
import "org/project_planton/provider/auth0/auth0resourceserver/v1/stack_outputs.proto";
import "org/project_planton/shared/metadata.proto";

// Auth0ResourceServer is a deployment component that configures a Resource Server (API) in Auth0.
// Resource Servers represent the APIs that your applications can request access to.
// They are essential for implementing OAuth 2.0 API authorization with Auth0.
//
// This component supports:
// - Defining API identifiers (audiences) for authorization flows
// - Configuring token settings (lifetime, signing algorithm, dialect)
// - Setting up scopes (permissions) for fine-grained access control
// - Enabling RBAC for role-based API access
//
// Example manifest for a simple API:
// ```yaml
// apiVersion: auth0.project-planton.org/v1
// kind: Auth0ResourceServer
// metadata:
//   name: my-api
//   org: my-organization
// spec:
//   identifier: https://api.example.com/
//   name: My Example API
//   signing_alg: RS256
//   token_lifetime: 86400
//   allow_offline_access: true
//   scopes:
//     - name: read:data
//       description: Read access to data
//     - name: write:data
//       description: Write access to data
// ```
//
// Example manifest for API with RBAC enabled:
// ```yaml
// apiVersion: auth0.project-planton.org/v1
// kind: Auth0ResourceServer
// metadata:
//   name: rbac-api
//   org: my-organization
// spec:
//   identifier: https://api.example.com/v2
//   name: My RBAC-Enabled API
//   signing_alg: RS256
//   token_lifetime: 3600
//   enforce_policies: true
//   token_dialect: access_token_authz
//   skip_consent_for_verifiable_first_party_clients: true
//   scopes:
//     - name: read:users
//       description: Read user profiles
//     - name: write:users
//       description: Create and update users
//     - name: delete:users
//       description: Delete users
// ```
message Auth0ResourceServer {
  // api_version is the version of the Auth0 API resource.
  // Must be "auth0.project-planton.org/v1" for this version.
  string api_version = 1 [(buf.validate.field).string.const = 'auth0.project-planton.org/v1'];

  // kind is the Kubernetes Resource Model (KRM) kind.
  // Must be "Auth0ResourceServer" for this resource type.
  string kind = 2 [(buf.validate.field).string.const = 'Auth0ResourceServer'];

  // metadata contains standard cloud resource metadata.
  // - name: Unique identifier for the resource server within Project Planton
  // - org: Organization that owns this API
  // - env: Environment (development, staging, production)
  // - labels: Key-value pairs for filtering and organization
  org.project_planton.shared.CloudResourceMetadata metadata = 3 [(buf.validate.field).required = true];

  // spec contains the desired configuration for the Auth0 Resource Server.
  // This includes the API identifier, token settings, and scope definitions.
  Auth0ResourceServerSpec spec = 4 [(buf.validate.field).required = true];

  // status contains the current state of the Auth0 Resource Server.
  // This is populated by the system after deployment and includes
  // the resource ID and other runtime information.
  Auth0ResourceServerStatus status = 5;
}

// Auth0ResourceServerStatus represents the current state of an Auth0 Resource Server resource.
// This is populated by the deployment system and contains read-only outputs.
message Auth0ResourceServerStatus {
  // outputs contains the stack outputs from the Auth0 Resource Server deployment.
  // These values are populated after successful deployment and include
  // identifiers and configuration details.
  Auth0ResourceServerStackOutputs outputs = 1;
}
